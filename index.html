<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debora's Alien</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style> body { display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; } </style>
</head>

<body>
    <script>
        // define o espaço na tela do navegador que será utilizado para exibir o jogo
        const larguraJogo = 700;
        const alturaJogo = 850;

        // definição das configurações do jogo
        const config = {
            type: Phaser.AUTO,
            width: larguraJogo,
            height: alturaJogo,
            
            // Aplica leis da física ao funcionamento do jogo
            physics: {
                default:'arcade',
                arcade: {
                    gravity:{y:300}, // define a gravidade do jogo (quão rápido o alien cai)
                    debug: true, // representa a área da imagem que vai ser considerada como corpo físico (indicado com o quadrado roxo), bem como representa a orientação de movimento da imagem, ou seja, a sua aceleração (linha verde)
                    
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const game = new Phaser.Game(config); // inicialização de um novo jogo utilizando o framework Phaser

        // declarando variáveis
        var alien;
        var teclado;
        var fogo;
        var plataforma1;
        var plataforma2;
        var moeda;
        var pontuacao = 0; // pontuação inicia em zero
        var placar;

        function preload() // Carrega as imagens: background, alien, fogo, plataforma e moeda
        {        
            this.load.image('background', 'assets/bg.png');
            this.load.image('player', 'assets/alienigena.png');
            this.load.image('turbo_nave', 'assets/turbo.png');
            this.load.image('plataforma_tijolo','assets/tijolos.png');
            this.load.image('moeda','assets/moeda.png')
        }

        function create() //Adiciona as imagens na tela (a ordem de alistamento define a sobreposição das imagens entre si - da camada superior para a inferior)
        {
            // exibe o background e define o posicionamento na tela
            this.add.image(larguraJogo/2, alturaJogo/2, 'background');
            
            // exibe o fogo identificando-a como uma figura animada
            fogo = this.add.sprite(0,0,'turbo_nave');
            fogo.setVisible(false);

            // exibe o alien identificando-a como figura móvel, definindo o posicionamento, barreiras e controles mecânicos
            alien = this.physics.add.sprite(larguraJogo/2, 0, 'player');
            alien.setCollideWorldBounds(true);
            alien.body.setSize(120,100,true);

            teclado = this.input.keyboard.createCursorKeys(); // libera o acesso às teclas de setas do teclado

            // exibe as plataformas identificando-as como figuras estáticas, e definindo o posicionamento na tela e as colisões com outras figuras
            plataforma1 = this.physics.add.staticImage(larguraJogo/2, alturaJogo/2,'plataforma_tijolo'); // plataforma de baixo
            this.physics.add.collider(alien, plataforma1);
            plataforma2 = this.physics.add.staticImage(larguraJogo/4, alturaJogo/4,'plataforma_tijolo'); // plataforma de cima
            this.physics.add.collider(alien, plataforma2);

            // exibe as moedas definindo o lugar onde vão cair pela primeira vez, as barreiras, reação com o chão e colisões com outras figuras
            moeda = this.physics.add.sprite(larguraJogo/2,0,'moeda');
            moeda.setCollideWorldBounds(true); 
            moeda.setBounce(0.7); // quanto menor, menos alto a moeda sobe depois de colidir com o chão
            this.physics.add.collider(moeda,plataforma1);
            this.physics.add.collider(moeda,plataforma2);

            // adiciona o placar (posição, conteúdo - concatenação entre o texto e a variável que guarda a pontuação-, tamanho da fonte e cor do texto)
            placar = this.add.text(50, 50, 'Moedas:' + pontuacao, {fontSize:'45px', fill:'#495613'});
        
            // Define a dinâmica da moeda
            this.physics.add.overlap(alien,moeda,
                function(){
                //interação moeda-alien
                moeda.setVisible(false); // quando alien e moeda se sobrepõem, a moeda fica invisível
                var posicaoMoeda_Y = Phaser.Math.RND.between(50,650); // a seguir um número é sorteado e guardado numa variável
                moeda.setPosition(posicaoMoeda_Y,100); //esse valor é utilizado para re-posicionamento da moeda na tela (por isso a posição da moeda é diferente a cada vez que um ponto é feito)
                //interação moeda-placar
                pontuacao +=1; // no caso de sobreposição, uma pontuação é somada ao placar
                placar.setText('Moedas:' + pontuacao); // atualiza os valores exibidos no placar
                moeda.setVisible(true); // ativa-se então a visualização de uma nova moeda
            });

            //LEGENDAS
                // add.image != add.spite (pode ser animado) != add.staticImage != add.text
                // larguraJogo/x, alturaJogo/x -- define o posicionamento da figura dentro da tela do jogo (o qual foi delimitado nas variáveis const em <script>)
                // .setCollideWorldBounds(true) -- define  barreiras físicas na tela, impedindo que a figura suma da tela de jogo
                // add.collider -- define que os dois elementos dentro dos parenteses não podem se atravessar.
                // add.overlap -- define que os dois elementos dentro dos parenteses podem se atravessar.
                // .setBounce -- define o quanto a figura vai subir como uma reação a velociade em que chega no chão
            
            // seria legal se essa barra se movesse da direita para a esquerda

        }

        function update()
        
        {// Ativando os controles ao Alien
            //ao clicar na tecla da esquerda, o alien se move para a esquerda numa distância de 150 px [ -> ]
            if (teclado.left.isDown) {
                alien.setVelocityX(-150); }
            //ao clicar na tecla da direita, o alien se move para a direita numa distância de 150 px [ -> ]
            else if (teclado.right.isDown) {
                alien.setVelocityX(150); }
            // Garante que o alien pare o movimento no caso de nenhuma tecla estar sendo acionada. Na sua ausência, o alien continuaria a se mover de acordo com a última tecla que foi clicada.
            else {
                alien.setVelocityX(0);}
            // Movimento para cima [^] e imagem do fogo aparece
            if (teclado.up.isDown) {
                alien.setVelocityY(-150); 
                ativarTurbo(); }
            // Movimento para baixo em y seguindo a gravidade em y e imagem do turbo some 
            else {semTurbo(); }

            // define a posição do fogo em relação ao Alien: o fogo segue a orientação cartesiana do Alien e se posiciona no centro da figura
            fogo.setPosition(alien.x, alien.y + alien.height/2);
        }
        
        // Define as funções "ativarTurbo" e "semTurbo" com os códigos que devem ser executados quando as funções forem evocadas
        function ativarTurbo(){
            fogo.setVisible(true);
        }
        function semTurbo(){
            fogo.setVisible(false);
        }

    </script>
</body>
</html>
